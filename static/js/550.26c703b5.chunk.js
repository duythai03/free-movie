"use strict";(self.webpackChunkfree_movie=self.webpackChunkfree_movie||[]).push([[550],{5550:(t,e,s)=>{s.r(e),s.d(e,{GoogleCastProvider:()=>d});var i=s(9607),a=s(7108),n=s(684);s(5043);class r{constructor(t){this.ab=new chrome.cast.media.MediaInfo(t.src,t.type)}build(){return this.ab}mj(t){return t.includes("live")?this.ab.streamType=chrome.cast.media.StreamType.LIVE:this.ab.streamType=chrome.cast.media.StreamType.BUFFERED,this}nj(t){return this.ab.tracks=t.map(this.oj),this}pj(t,e){return this.ab.metadata=new chrome.cast.media.GenericMediaMetadata,this.ab.metadata.title=t,this.ab.metadata.images=[{url:e}],this}oj(t,e){const s=new chrome.cast.media.Track(e,chrome.cast.media.TrackType.TEXT);return s.name=t.label,s.trackContentId=t.src,s.trackContentType="text/vtt",s.language=t.language,s.subtype=t.kind.toUpperCase(),s}}const h=chrome.cast.media.TrackType.TEXT,o=chrome.cast.media.TrackType.AUDIO;class c{constructor(t,e,s){this.pd=t,this.b=e,this.Be=s}ie(){const t=this.vg.bind(this);(0,i.listenEvent)(this.b.audioTracks,"change",t),(0,i.listenEvent)(this.b.textTracks,"mode-change",t),(0,i.effect)(this.qj.bind(this))}od(){return this.b.$state.textTracks().filter((t=>t.src&&"vtt"===t.type))}wg(){return this.b.$state.audioTracks()}yc(t){var e,s;const i=null!==(e=null===(s=this.pd.mediaInfo)||void 0===s?void 0:s.tracks)&&void 0!==e?e:[];return t?i.filter((e=>e.type===t)):i}rj(){const t=[],e=this.wg().find((t=>t.selected)),s=this.od().filter((t=>"showing"===t.mode));if(e){const s=this.yc(o),i=this.Ae(s,e);i&&t.push(i.trackId)}if(null!==s&&void 0!==s&&s.length){const e=this.yc(h);if(e.length)for(const i of s){const s=this.Ae(e,i);s&&t.push(s.trackId)}}return t}qj(){const t=this.od();if(!this.pd.isMediaLoaded)return;const e=this.yc(h);for(const s of t){if(!this.Ae(e,s)){(0,i.untrack)((()=>{var t;return null===(t=this.Be)||void 0===t?void 0:t.call(this)}));break}}}sj(t){if(!this.pd.isMediaLoaded)return;const e=this.wg(),s=this.od(),i=this.yc(o),n=this.yc(h);for(const h of i){var r;if(this.xg(e,h))continue;const s={id:h.trackId.toString(),label:h.name,language:h.language,kind:null!==(r=h.subtype)&&void 0!==r?r:"main",selected:!1};this.b.audioTracks[a.jH.ea](s,t)}for(const a of n){if(this.xg(s,a))continue;const e={id:a.trackId.toString(),src:a.trackContentId,label:a.name,language:a.language,kind:a.subtype.toLowerCase()};this.b.textTracks.add(e,t)}}vg(t){if(!this.pd.isMediaLoaded)return;const e=this.rj(),s=new chrome.cast.media.EditTracksInfoRequest(e);this.tj(s).catch((t=>{}))}tj(t){const e=(0,n.getCastSessionMedia)();return new Promise(((s,i)=>null===e||void 0===e?void 0:e.editTracksInfo(t,s,i)))}xg(t,e){return t.find((t=>this.yg(t,e)))}Ae(t,e){return t.find((t=>this.yg(e,t)))}yg(t,e){return e.name===t.label&&e.language===t.language&&e.subtype.toLowerCase()===t.kind.toLowerCase()}}class d{constructor(t,e){this.f=t,this.b=e,this.$$PROVIDER_TYPE="GOOGLE_CAST",this.scope=(0,i.createScope)(),this.L=null,this.Aa="disconnected",this.va=0,this.ha=0,this.Ba=new a.zJ(0,0),this.ga=new a.e8(this.lc.bind(this)),this.Qa=null,this.Ce=!1,this.wa=new c(this.f,this.b,this.Be.bind(this))}get c(){return this.b.delegate.c}get type(){return"google-cast"}get currentSrc(){return this.L}get player(){return this.f}get cast(){return(0,n.getCastContext)()}get session(){return(0,n.getCastSession)()}get media(){return(0,n.getCastSessionMedia)()}get hasActiveSession(){return(0,n.hasActiveCastSession)(this.L)}setup(){this.uj(),this.vj(),this.wa.ie(),this.c("provider-setup",this)}uj(){(0,n.listenCastContextEvent)(cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.Ag.bind(this))}vj(){const t=cast.framework.RemotePlayerEventType,e={[t.IS_CONNECTED_CHANGED]:this.Ag,[t.IS_MEDIA_LOADED_CHANGED]:this.Bg,[t.CAN_CONTROL_VOLUME_CHANGED]:this.Cg,[t.CAN_SEEK_CHANGED]:this.Dg,[t.DURATION_CHANGED]:this.ee,[t.IS_MUTED_CHANGED]:this.Oa,[t.VOLUME_LEVEL_CHANGED]:this.Oa,[t.IS_PAUSED_CHANGED]:this.wj,[t.LIVE_SEEKABLE_RANGE_CHANGED]:this.ob,[t.PLAYER_STATE_CHANGED]:this.xj};this.zg=e;const s=this.yj.bind(this);for(const a of(0,i.keysOf)(e))this.f.controller.addEventListener(a,s);(0,i.onDispose)((()=>{for(const t of(0,i.keysOf)(e))this.f.controller.removeEventListener(t,s)}))}async play(){var t;(this.f.isPaused||this.Ce)&&(this.Ce?await this.Eg(!1,0):null===(t=this.f.controller)||void 0===t||t.playOrPause())}async pause(){var t;this.f.isPaused||null===(t=this.f.controller)||void 0===t||t.playOrPause()}getMediaStatus(t){return new Promise(((e,s)=>{var i;null===(i=this.media)||void 0===i||i.getStatus(t,e,s)}))}setMuted(t){var e;(t&&!this.f.isMuted||!t&&this.f.isMuted)&&(null===(e=this.f.controller)||void 0===e||e.muteOrUnmute())}setCurrentTime(t){var e;this.f.currentTime=t,this.c("seeking",t),null===(e=this.f.controller)||void 0===e||e.seek()}setVolume(t){var e;this.f.volumeLevel=t,null===(e=this.f.controller)||void 0===e||e.setVolumeLevel()}async loadSource(t){var e;if((null===(e=this.Qa)||void 0===e?void 0:e.src)!==t&&(this.Qa=null),(0,n.hasActiveCastSession)(t))return this.zj(),void(this.L=t);this.c("load-start");const s=this.Aj(t),i=await this.session.loadMedia(s);if(i)return this.L=null,void this.c("error",Error((0,n.getCastErrorMessage)(i)));this.L=t}destroy(){this.A(),this.Fg()}A(){this.Qa||(this.ha=0,this.Ba=new a.zJ(0,0)),this.ga.aa(),this.va=0,this.Qa=null}zj(){var t;const e=new i.DOMEvent("resume-session",{detail:this.session});this.Bg(e);const{muted:s,volume:a,savedState:n}=this.b.$state,r=n();this.setCurrentTime(Math.max(this.f.currentTime,null!==(t=null===r||void 0===r?void 0:r.currentTime)&&void 0!==t?t:0)),this.setMuted(s()),this.setVolume(a()),!1===(null===r||void 0===r?void 0:r.paused)&&this.play()}Fg(){this.cast.endCurrentSession(!0);const{remotePlaybackLoader:t}=this.b.$state;t.set(null)}Bj(){const{savedState:t}=this.b.$state;t.set({paused:this.f.isPaused,currentTime:this.f.currentTime}),this.Fg()}lc(){this.Cj()}yj(t){this.zg[t.type].call(this,t)}Ag(t){const e=this.cast.getCastState(),s=e===cast.framework.CastState.CONNECTED?"connected":e===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(this.Aa===s)return;const i={type:"google-cast",state:s},a=this.bb(t);this.Aa=s,this.c("remote-playback-change",i,a),"disconnected"===s&&this.Bj()}Bg(t){if(!!!this.f.isMediaLoaded)return;const e=(0,i.peek)(this.b.$state.source);Promise.resolve().then((()=>{if(e!==(0,i.peek)(this.b.$state.source)||!this.f.isMediaLoaded)return;this.A();const s=this.f.duration;this.Ba=new a.zJ(0,s);const n={provider:this,duration:s,buffered:new a.zJ(0,0),seekable:this.Gg()},r=this.bb(t);this.c("loaded-metadata",void 0,r),this.c("loaded-data",void 0,r),this.c("can-play",n,r),this.Cg(),this.Dg(t);const{volume:h,muted:o}=this.b.$state;this.setVolume(h()),this.setMuted(o()),this.ga.Ya(),this.wa.sj(r),this.wa.vg(r)}))}Cg(){this.b.$state.canSetVolume.set(this.f.canControlVolume)}Dg(t){const e=this.bb(t);this.c("stream-type-change",this.Dj(),e)}Dj(){var t;return(null===(t=this.f.mediaInfo)||void 0===t?void 0:t.streamType)===chrome.cast.media.StreamType.LIVE?this.f.canSeek?"live:dvr":"live":"on-demand"}Cj(){if(this.Qa)return;const t=this.f.currentTime;t!==this.va&&(this.c("time-change",t),t>this.ha&&(this.ha=t,this.ob()),this.b.$state.seeking()&&this.c("seeked",t),this.va=t)}ee(t){if(!this.f.isMediaLoaded||this.Qa)return;const e=this.f.duration,s=this.bb(t);this.Ba=new a.zJ(0,e),this.c("duration-change",e,s)}Oa(t){if(!this.f.isMediaLoaded)return;const e={muted:this.f.isMuted,volume:this.f.volumeLevel},s=this.bb(t);this.c("volume-change",e,s)}wj(t){const e=this.bb(t);this.f.isPaused?this.c("pause",void 0,e):this.c("play",void 0,e)}ob(t){const e={seekable:this.Gg(),buffered:new a.zJ(0,this.ha)},s=t?this.bb(t):void 0;this.c("progress",e,s)}xj(t){const e=this.f.playerState,s=chrome.cast.media.PlayerState;if(this.Ce=e===s.IDLE,e===s.PAUSED)return;const i=this.bb(t);switch(e){case s.PLAYING:this.c("playing",void 0,i);break;case s.BUFFERING:this.c("waiting",void 0,i);break;case s.IDLE:this.ga.aa(),this.c("pause"),this.c("end")}}Gg(){return this.f.liveSeekableRange?new a.zJ(this.f.liveSeekableRange.start,this.f.liveSeekableRange.end):this.Ba}bb(t){return t instanceof Event?t:new i.DOMEvent(t.type,{detail:t})}Ej(t){const{streamType:e,title:s,poster:i}=this.b.$state;return new r(t).pj(s(),i()).mj(e()).nj(this.wa.od()).build()}Aj(t){var e,s,i,a,n;const r=this.Ej(t),h=new chrome.cast.media.LoadRequest(r),o=this.b.$state.savedState();return h.autoplay=!1===(null!==(e=null===(s=this.Qa)||void 0===s?void 0:s.paused)&&void 0!==e?e:null===o||void 0===o?void 0:o.paused),h.currentTime=null!==(i=null!==(a=null===(n=this.Qa)||void 0===n?void 0:n.time)&&void 0!==a?a:null===o||void 0===o?void 0:o.currentTime)&&void 0!==i?i:0,h}async Eg(t,e){const s=(0,i.peek)(this.b.$state.source);this.Qa={src:s,paused:t,time:e},await this.loadSource(s)}Be(){this.Eg(this.f.isPaused,this.f.currentTime).catch((t=>{}))}}}}]);
//# sourceMappingURL=550.26c703b5.chunk.js.map